import { ApiProperty, ApiPropertyOptional } from '@nestjs/swagger';
import { 
  IsEmail, 
  IsNotEmpty, 
  IsString, 
  IsUUID, 
  IsOptional, 
  MinLength,
  IsPhoneNumber,
  IsDateString,
  IsUrl
} from 'class-validator';

/* ======================================================
   1. USER SIGNUP REQUEST (AUTH SERVICE)
   - Used for the public-facing individual signup API.
   - Includes Password but NO userUuid (Auth generates this).
====================================================== */

export class UserSignupRequestDto {
  @ApiProperty({ description: 'User first name', example: 'Jane' })
  @IsString()
  @IsNotEmpty()
  firstName!: string;

  @ApiProperty({ description: 'User last name', example: 'Doe' })
  @IsString()
  @IsNotEmpty()
  lastName!: string;

  @ApiProperty({
    description: 'Login email and primary contact for the user',
    example: 'jane.doe@pivota.com',
  })
  @IsEmail()
  @IsNotEmpty()
  email!: string;

  @ApiProperty({
    description: 'International phone number (e.g., +254...)',
    example: '+254700111222',
  })
  @IsNotEmpty()
  @IsPhoneNumber(undefined, { message: 'Invalid phone number format' })
  phone!: string;

  @ApiProperty({
    description: 'Secure password for the individual account',
    example: 'StrongPass@2026',
  })
  @IsString()
  @IsNotEmpty()
  @MinLength(8)
  password!: string;
}

/* ======================================================
   2. CREATE USER REQUEST (PROFILE SERVICE)
   - Used for internal gRPC/Service communication.
   - Includes userUuid from Auth but NO Password.
====================================================== */

export class CreateUserRequestDto {
  @ApiProperty({
    description: 'The UUID pre-generated by Auth Service to anchor identity',
    example: 'u-1234-uuid-5678',
  })
  @IsUUID()
  @IsNotEmpty()
  userUuid!: string;

  @ApiProperty({ example: 'Jane' })
  @IsString()
  @IsNotEmpty()
  firstName!: string;

  @ApiProperty({ example: 'Doe' })
  @IsString()
  @IsNotEmpty()
  lastName!: string;

  @ApiProperty({ example: 'jane.doe@pivota.com' })
  @IsEmail()
  @IsNotEmpty()
  email!: string;

  @ApiProperty({ example: '+254700111222' })
  @IsPhoneNumber(undefined)
  @IsNotEmpty()
  phone!: string;
}

/* ======================================================
   3. UPDATE USER PROFILE REQUEST
   - Maps to the UserProfile metadata table.
====================================================== */

export class UpdateUserProfileRequestDto {
  @ApiPropertyOptional({ 
    description: 'Short professional or personal biography',
    example: 'Software Engineer based in Nairobi.' 
  })
  @IsOptional()
  @IsString()
  bio?: string;

  @ApiPropertyOptional({ 
    description: 'Biological gender identity',
    example: 'FEMALE'
  })
  @IsOptional()
  @IsString()
  gender?: string;

  @ApiPropertyOptional({ 
    description: 'Date of birth for age verification (ISO Format)',
    example: '1995-05-15T00:00:00Z' 
  })
  @IsOptional()
  @IsDateString()
  dateOfBirth?: string;

  @ApiPropertyOptional({ 
    description: 'Government-issued National ID or Passport number',
    example: '32145678' 
  })
  @IsOptional()
  @IsString()
  nationalId?: string;

  @ApiPropertyOptional({
    description: 'URL to the user profile avatar/image',
    example: 'https://cdn.pivota.com/profiles/u123.jpg'
  })
  @IsOptional()
  @IsUrl()
  profileImage?: string;
}