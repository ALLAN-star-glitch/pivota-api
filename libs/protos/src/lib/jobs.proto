syntax = "proto3";

package jobs;

// ===================================================
// SERVICE DEFINITION
// ===================================================
service JobsService {
  // Now returns a specific Lean response for Creation
  rpc CreateJobPost (CreateJobPostRequest) returns (BaseJobPostCreateResponse);
  
  rpc GetJobPostById (GetJobPostByIdRequest) returns (BaseJobPostResponse);
  rpc GetJobsByCategory (GetJobsByCategoryRequest) returns (ListJobPostsResponse);
  rpc ValidateJobPostIds(ValidateJobPostIdsRequest) returns (BaseValidateJobPostIdsResponse);
  
  rpc UpdateJobPost (UpdateJobPostRequest) returns (BaseJobPostResponse);
  rpc CloseJobPost (CloseJobPostRequest) returns (BaseCloseJobPostResponse);
  rpc ApplyToJobPost (CreateJobApplicationRequest) returns (BaseJobApplicationResponse);
}

// ===================================================
// SHARED PAYLOADS
// ===================================================
message ErrorPayload {
  string code = 1;
  string message = 2;
  string details = 3;
}

message UserBasic {
  string id = 1;
  string fullName = 2;
  string email = 3;
}

message AccountBasic {
  string id = 1;
  string name = 2;
}

message CategoryBasic {
  string id = 1;
  string name = 2;
}

// ===================================================
// JOB APPLICATION ENTITIES
// ===================================================
message Attachment {
  string type = 1;
  string fileUrl = 2;
  string fileName = 3;
  string contentText = 4;
  bool isPrimary = 5;
}

message StatusHistory {
  string oldStatus = 1;
  string newStatus = 2;
  string changedBy = 3;
  string reason = 4;
  string createdAt = 5;
}

message JobApplication {
  string id = 1;
  string externalId = 2;
  string jobPostId = 3;
  string applicantId = 4;
  string employerId = 5;
  string status = 6;
  double expectedPay = 7;
  string availabilityDate = 8;
  string availabilityNotes = 9;
  string referrerName = 10;
  string referrerPhone = 11;
  string referrerEmail = 12; 
  string referrerRelationship = 13;
  string createdAt = 14;
  string reviewedAt = 15;
  repeated Attachment attachments = 16;
  repeated StatusHistory statusHistory = 17;
}

// ===================================================
// JOB POST ENTITY (Rich DTO for GET/LIST)
// ===================================================
message JobPost {
  string id = 1;
  string title = 2;
  string description = 3;
  CategoryBasic category = 4;
  CategoryBasic subCategory = 5;
  UserBasic creator = 6;
  AccountBasic account = 7; 
  string jobType = 8;
  string locationCity = 9;
  string locationNeighborhood = 10;
  bool isRemote = 11;
  bool requiresDocuments = 12;
  bool requiresEquipment = 13;
  double payAmount = 14;
  string payRate = 15;
  bool isNegotiable = 16;
  repeated string skills = 17;
  string experienceLevel = 18;
  string employmentType = 19;
  repeated string documentsNeeded = 20;
  repeated string equipmentRequired = 21;
  string additionalNotes = 22;
  string status = 23;
  int32 applicationsCount = 24;
  string createdAt = 25;
  string updatedAt = 26;
}

// ===================================================
// REQUEST MESSAGES
// ===================================================

message CreateJobPostRequest {
  string title = 1;
  string description = 2;
  string categoryId = 3;
  string subCategoryId = 4;
  string jobType = 5;
  string locationCity = 6;
  string locationNeighborhood = 7;
  bool isRemote = 8;
  double payAmount = 9;
  string payRate = 10;
  bool isNegotiable = 11;
  bool requiresDocuments = 12;
  bool requiresEquipment = 13;
  repeated string skills = 14;
  string experienceLevel = 15;
  string employmentType = 16;
  repeated string documentsNeeded = 17;
  repeated string equipmentRequired = 18;
  string additionalNotes = 19;
  string status = 20;

  // Identity Pillars (Lean: No Name strings stored anymore)
  string accountId = 21;
  string creatorId = 22;
}

message UpdateJobPostRequest {
  string id = 1;
  string creatorId = 2; 

  optional string title = 3;
  optional string description = 4;
  optional string status = 5;
  optional double payAmount = 6;
  optional bool isNegotiable = 7;
  optional string locationCity = 8;
  optional string locationNeighborhood = 9;
}

message CreateJobApplicationRequest {
  string jobPostId = 1;
  string applicantId = 2;
  bool hasRequiredEquipment = 3; 
  double expectedPay = 4;
  string availabilityDate = 5;
  string availabilityNotes = 6;
  string referrerName = 7;
  string referrerPhone = 8;
  string referrerEmail = 9;
  string referrerRelationship = 10;
  repeated Attachment attachments = 11;
}

message CloseJobPostRequest {
  string id = 1;
  string creatorId = 2;
  string reason = 3;
}

message GetJobPostByIdRequest { string id = 1; }
message GetJobsByCategoryRequest { string categoryId = 1; }
message ValidateJobPostIdsRequest { repeated string ids = 1; }

// ===================================================
// RESPONSE MESSAGES
// ===================================================

// NEW: Ultra-Lean Data for Creation
message JobPostCreateData {
  string id = 1;
  string status = 2;
  string createdAt = 3;
}

// NEW: Ultra-Lean Base Response for Creation
message BaseJobPostCreateResponse {
  bool success = 1;
  string code = 2;
  string message = 3;
  JobPostCreateData data = 4;
  ErrorPayload error = 5;
}

message BaseJobPostResponse {
  bool success = 1;
  string code = 2;
  string message = 3;
  JobPost data = 4; 
  ErrorPayload error = 5;
}

message ListJobPostsResponse {
  bool success = 1;
  string code = 2;
  string message = 3;
  repeated JobPost data = 4;
  ErrorPayload error = 5;
}

message CloseJobPostData {
  string id = 1;
  string status = 2;
  bool isClosed = 3;
  string closedAt = 4;
}

message BaseCloseJobPostResponse {
  bool success = 1;
  string code = 2;
  string message = 3;
  CloseJobPostData data = 4;
  ErrorPayload error = 5;
}

message BaseJobApplicationResponse {
  bool success = 1;
  string code = 2;
  string message = 3;
  JobApplication data = 4;
  ErrorPayload error = 5;
}

message ValidateJobIdsData {
   repeated string validIds = 1;
   repeated string invalidIds = 2;
}

message BaseValidateJobPostIdsResponse {
  bool success = 1;
  string code = 2;
  string message = 3;
  ValidateJobIdsData data = 4;
  ErrorPayload error = 5;
}