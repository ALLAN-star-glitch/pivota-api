syntax = "proto3";

package profile;

// ================== Service Definitions ==================

service ProfileService {
  // Core profile operations (Now returning the Trio structure)
  rpc CreateUserProfile(CreateUserProfileRequest) returns (UserProfileResponse);
  rpc GetUserProfileByUuid(GetUserByUuidRequest) returns (UserProfileResponse);
  rpc GetUserProfileByUserCode(GetUserByUserCodeRequest) returns (UserProfileResponse);
  rpc GetUserProfileByEmail(GetUserByEmailRequest) returns (UserProfileResponse);

  // Admin or dashboard-only operations
  rpc GetAllUsers(Empty) returns (UserListResponse);

  // Organization Signup flow (Kept as requested)
  rpc CreateOrganizationProfile(CreateOrgProfileRequest) returns (OrgProfileResponse);
}

// ================== User Profile Messages (The Trio) ==================

message CreateUserProfileRequest {
  string userUuid = 1;          // Anchor identity from Auth Service
  string firstName = 2;
  string lastName = 3;
  string email = 4;
  string phone = 5;
}

message UserProfileResponse {
  bool success = 1;
  string message = 2;
  string code = 3;
  UserProfileTrio data = 4;      // Aligned with UserProfileResponseDto
  ErrorPayload error = 5;  
}

// This represents the "Trio" architecture: Account + User + Profile
message UserProfileTrio {
  AccountBase account = 1;
  UserBase user = 2;
  UserProfileMetadata profile = 3;
  string createdAt = 4;
  string updatedAt = 5;
  CompletionResponse completion = 6;
}

// Matches UserBaseDto
message UserBase {
  string uuid = 1;
  string userCode = 2;
  string firstName = 3;
  string lastName = 4;
  string email = 5;
  string phone = 6;
  string status = 7;
  string roleName = 8;
}

// Matches UserProfileDataDto
message UserProfileMetadata {
  string bio = 1;
  string gender = 2;
  string dateOfBirth = 3;
  string nationalId = 4;
  string profileImage = 5;
}

// ================== Organization Messages (Unchanged) ==================

message CreateOrgProfileRequest {
  string name = 1;              
  string officialEmail = 2;     
  string officialPhone = 3;     
  string physicalAddress = 4;   
  string adminUserUuid = 5;     
  string email = 6;             
  string phone = 7;             
  string adminFirstName = 8;    
  string adminLastName = 9;  
}

message OrgProfileResponse {
  bool success = 1;
  string message = 2;
  string code = 3;
  OrgProfileData data = 4;      
  ErrorPayload error = 5;
}

message OrgProfileData {
  string id = 1;
  string uuid = 2;
  string name = 3;
  string orgCode = 4;
  string verificationStatus = 5;
  string officialEmail = 6;
  string officialPhone = 7;
  string physicalAddress = 8;
  AccountBase account = 9;      
  AdminResponse admin = 10;     
  CompletionResponse completion = 11; 
  string createdAt = 12;        
  string updatedAt = 13;
}

// ================== Shared Components ==================

message AccountBase {
  string uuid = 1;
  string accountCode = 2;
  string type = 3; // e.g., "INDIVIDUAL" or "ORGANIZATION"
}

message AdminResponse {
  string uuid = 1;
  string userCode = 2;
  string email = 3;
  string phone = 4;
  string firstName = 5;
  string lastName = 6;
  string roleName = 7;
}

message CompletionResponse {
  int32 percentage = 1;
  repeated string missingFields = 2;
  bool isComplete = 3;
}

// ================== Common Messages ==================

message GetUserByUuidRequest { string userUuid = 1; }
message GetUserByUserCodeRequest { string userCode = 1; }
message GetUserByEmailRequest { string email = 1; }

message UserListResponse {
  bool success = 1;
  string message = 2;
  string code = 3;
  repeated UserProfileTrio data = 4; 
  ErrorPayload error = 5;          
}

message ErrorPayload {
  string message = 1;
  int32 code = 2;
}

message Empty {}