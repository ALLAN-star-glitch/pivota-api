generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/// === JOB TYPES ===
enum JobType {
  INFORMAL
  FORMAL
}

/// === JOB POST STATUS ===
enum JobPostStatus {
  ACTIVE
  CLOSED
  DRAFT
}
 
/// === APPLICATION STATUS ===
enum ApplicationStatus {
  PENDING
  ACCEPTED
  REJECTED
}

/// === BOOKING STATUS ===
enum BookingStatus {
  PENDING
  ACCEPTED
  REJECTED
  COMPLETED
}

/// =====================================================================
///                            JOB CATEGORIES
/// =====================================================================
model JobCategory {
  id            String   @id @default(cuid())        // internal ID
  externalId    String   @default(uuid())           // public/external ID
  name          String
  description   String?     
  categoryType  JobType
  parentId      String?
  parent        JobCategory?  @relation("Subcategories", fields: [parentId], references: [id])
  subcategories JobCategory[] @relation("Subcategories")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  /// Relations to jobs
  informalJobPosts  JobPost[]
  formalJobPosts    JobPost[]
  providerJobs      ProviderJob[]
}

/// =====================================================================
///                            JOB POSTS
/// =====================================================================
model JobPost {
  id          String   @id @default(cuid())
  externalId  String   @default(uuid())
  title       String
  description String
  categoryId  String
  category    JobCategory  @relation(fields: [categoryId], references: [id])
  creatorId   String       // reference User Service ID
  jobType     JobType
  locationCity         String
  locationNeighborhood String?
  isRemote             Boolean @default(false)
  payAmount            Float?
  payRate              String? // daily | weekly | hourly | fixed
  skills               String[] @default([])
  experienceLevel      String?
  employmentType       String?
  documentsNeeded      String[] @default([])
  equipmentRequired    String[] @default([])
  additionalNotes      String?
  status      JobPostStatus @default(ACTIVE)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  applications JobPostApplication[]
  bookings     Booking[]
}

/// =====================================================================
///                        JOB POST APPLICATIONS
/// =====================================================================
model JobPostApplication {
  id         String      @id @default(cuid())
  externalId String      @default(uuid())
  jobPostId  String
  jobPost    JobPost     @relation(fields: [jobPostId], references: [id])
  applicantId String     // reference User Service ID
  status      ApplicationStatus @default(PENDING)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @default(updatedAt)
}

/// =====================================================================
///                        PROVIDER SERVICE LISTINGS
/// =====================================================================
model ProviderJob {
  id          String   @id @default(cuid())
  externalId  String   @default(uuid())
  providerId  String       // reference User Service ID
  title       String
  description String
  categoryId  String
  category    JobCategory  @relation(fields: [categoryId], references: [id])
  price       Float
  location    String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @default(updatedAt)
}

/// =====================================================================
///                            BOOKINGS
/// =====================================================================
model Booking {
  id          String   @id @default(cuid())
  externalId  String   @default(uuid())
  jobPostId   String
  jobPost     JobPost   @relation(fields: [jobPostId], references: [id])
  providerId  String    // reference User Service ID
  status      BookingStatus @default(PENDING)
  scheduledDate DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(updatedAt)
}

/// =====================================================================
///                           RATINGS & REVIEWS
/// =====================================================================
model Rating {
  id          String   @id @default(cuid())
  externalId  String   @default(uuid())
  jobPostId   String?
  providerId  String?  // reference User Service ID
  employerId  String?  // reference User Service ID
  userId      String   // reviewer (User ID)
  rating      Int
  review      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(updatedAt)
}
