generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/// =====================================================================
///                            JOB CATEGORIES
/// =====================================================================
model JobCategory {
  id            String   @id @default(cuid())
  externalId    String   @default(uuid())
  name          String   @unique
  description   String?
  parentId      String?
  parent        JobCategory?  @relation("Subcategories", fields: [parentId], references: [id])
  subcategories JobCategory[] @relation("Subcategories")
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  hasSubcategories Boolean @default(false)
  hasParent        Boolean @default(false)

  jobPosts     JobPost[]          // main category posts
  subCategoryPosts JobPost[] @relation("SubcategoryPosts") // posts under this subcategory
  providerJobs ProviderJob[]
}


/// =====================================================================
///                            JOB POSTS
/// =====================================================================
model JobPost {
  id          String   @id @default(cuid())
  externalId  String   @default(uuid())
  title       String
  description String
  categoryId  String
  category    JobCategory @relation(fields: [categoryId], references: [id])

  subCategoryId  String?
  subCategory    JobCategory? @relation("SubcategoryPosts", fields: [subCategoryId], references: [id])

  creatorId   String
  jobType     String
  locationCity String
  locationNeighborhood String?
  isRemote   Boolean @default(false)

  requiresDocuments Boolean @default(false)
  requiresEquipment Boolean @default(false)

  payAmount Float?
  payRate   String?
  skills    String[] @default([])
  experienceLevel String?
  employmentType String?
  documentsNeeded String[] @default([])
  equipmentRequired String[] @default([])
  additionalNotes String?
  status String @default("ACTIVE")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  applications JobPostApplication[]
  bookings     Booking[]
}


/// =====================================================================
///                        JOB POST APPLICATIONS
/// =====================================================================
model JobPostApplication {
  id         String      @id @default(cuid())
  externalId String      @default(uuid())
  jobPostId  String
  jobPost    JobPost     @relation(fields: [jobPostId], references: [id])
  applicantId String     // reference User Service ID
  status      String     @default("PENDING") // was enum
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

/// =====================================================================
///                        PROVIDER SERVICE LISTINGS
/// =====================================================================
model ProviderJob {
  id          String   @id @default(cuid())
  externalId  String   @default(uuid())
  providerId  String       // reference User Service ID
  title       String
  description String
  categoryId  String
  category    JobCategory  @relation(fields: [categoryId], references: [id])
  price       Float
  location    String
  additionalNotes    String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

/// =====================================================================
///                            BOOKINGS
/// =====================================================================
model Booking {
  id          String   @id @default(cuid())
  externalId  String   @default(uuid())
  jobPostId   String
  jobPost     JobPost   @relation(fields: [jobPostId], references: [id])
  providerId  String    // reference User Service ID
  status      String    @default("PENDING") // was enum
  scheduledDate DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

/// =====================================================================
///                           RATINGS & REVIEWS
/// =====================================================================
model Rating {
  id          String   @id @default(cuid())
  externalId  String   @default(uuid())
  jobPostId   String?
  providerId  String?  // reference User Service ID
  employerId  String?  // reference User Service ID
  userId      String   // reviewer (User ID)
  rating      Int
  review      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
